<?php declare(strict_types=1);
namespace Open;

use function PHPUnit\Expect\{expect, it};
use PHPUnit\Framework\{TestCase};

/** Tests the features of the `Open\open()` function. */
class OpenTest extends TestCase {

  /** @test open() */
  function testOpen(): void {
    $googleChrome = PHP_OS_FAMILY == 'Darwin' ? 'google chrome' : (PHP_OS_FAMILY == 'Windows' ? 'chrome' : 'google-chrome');

    it('should open files in the default application', function() {
      open(__FILE__);
    });

    it('should open URLs in the default application', function() {
      open('https://belin.io');
    });

    it('should open URLs in the given application', function() {
      open('https://belin.io', ['application' => 'firefox']);
    });

    it('should open URLs in the given application with arguments', function() use ($googleChrome) {
      open('https://belin.io', ['application' => $googleChrome, 'arguments' => ['--incognito']]);
    });

    it('should wait for the application to close', function() use ($googleChrome) {
      open('https://belin.io', ['application' => $googleChrome, 'wait' => true]);
    });

    if (Wsl::isWsl()) {
      $googleChromeWsl = '/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe';

      it('should open URLs in the specified application by using a given WSL path', function() use ($googleChromeWsl) {
        open('https://belin.io', ['application' => $googleChromeWsl]);
      });

      it('should open URLs in the specified application with arguments by using a given WSL path', function() use ($googleChromeWsl) {
        open('https://belin.io', ['application' => $googleChromeWsl, 'arguments' => ['--incognito']]);
      });
    }

    // Mark this test as not risky.
    expect(true)->to->be->true;
  }
}
